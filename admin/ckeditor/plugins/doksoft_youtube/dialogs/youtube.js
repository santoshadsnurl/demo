(function(){var e=/^PT(?:(\d+)M)*(\d+)S$/;durationToTime=function(m){var k=m.match(e);if(!k){return"-";}var i=parseInt(k[1],10),j=parseInt(k[2],10);i=i||0;j=j||0;m=i*60+j;var g=Math.floor(m/3600),h=Math.floor((m-(g*3600))/60),n=m-(g*3600)-(h*60);if(g<10&&g>0){g="0"+g;}if(h<10){h="0"+h;}if(n<10){n="0"+n;}var l=h+":"+n;if(g){l=g+":"+l;}return l;};var c=(function(){var g=document.createElement("input"),h="oninput" in g;if(!h){g.setAttribute("oninput","return;");h=typeof g.oninput==="function";}return h;})();var b=function(i,h){this.editor=i;this.dialog=h;this.lang=i.lang.doksoft_youtube;this.path=CKEDITOR.plugins.get("doksoft_youtube").path;this.apiKey=this.editor.config.doksoft_youtube_apiKey||"";var j=CKEDITOR.document;this.videos=j.getById(i.name+"_doksoft_youtube_videos");this.preview=j.getById(i.name+"_doksoft_youtube_preview");var g=this.videos.getChildren();this.videosHint=g.getItem(0);this.videosList=g.getItem(1);this.preloader=g.getItem(2);g=this.preview.getChildren();this.previewHint=g.getItem(0);this.previewVideo=g.getItem(1);this.query=h.getContentElement("info","query");this.searchButton=h.getContentElement("info","btnSearch");this.url=h.getContentElement("info","url");this.size=h.getContentElement("info","size");this.width=h.getContentElement("info","width");this.height=h.getContentElement("info","height");this.showSuggested=h.getContentElement("info","showSuggested");this.privacyMode=h.getContentElement("info","privacyMode");this.useOldCode=h.getContentElement("info","useOldCode");this.videos.unselectable();this.preview.unselectable();h.on("show",this._onDialogShow,this);h.on("hide",this._onDialogHide,this);this.searchButton.on("click",function(){this.reset();this.search(this.query.getValue());},this);this.dialog.on("resize",function(l){var k=l.data.height;this.videos.setStyle("height",k-100+"px");this.preview.setStyle("height",k-250+"px");this.videosHint.setStyle("line-height",k-100+"px");this.previewHint.setStyle("line-height",k-250+"px");},this);this.maxResults=Math.min(50,Math.max(1,i.config.doksoft_youtube_maxResults));this._init();};b.prototype={sizes:{"sd":["420x315","480x360","640x480","960x720"],"hd":["560x315","640x360","853x480","1280x720"]},_onSelectVideo:function(g){var i=g.data.getTarget(),h=i&&i.getAscendant("li",true);if(h){this.selectVideo(h);g.data.preventDefault(true);}},_onScrollResults:function(g){var h=this.videos.$;if(h.scrollTop+h.clientHeight*2>h.scrollHeight){this.search(this._lastQuery);}},_onKey:function(g){var h=g.data.getKeystroke();cancel=false;if(h==13){if(jQuery&&jQuery.fn.autocomplete){jQuery(this.query.getInputElement().$).autocomplete("close");}this.searchButton.click();cancel=true;}if(h==27){if(jQuery&&jQuery.fn.autocomplete&&jQuery(this.query.getInputElement().$).autocomplete("widget").is(":visible")){cancel=true;}}if(cancel){g.cancel();g.data.preventDefault(1);}},_onUrlChange:function(){this.reset();var i=this.url.getValue(),g=this.url.getInputElement(),h=i.match(/^(?:(?:https?:\/\/)*(?:www\.|))*youtube.com\/watch\?.*?v=([a-zA-Z0-9_]*)(?:$|&)/i),j=h&&h[1];g.removeAttribute("title");g.removeClass("error");if(j){this.search([j]);}else{if(i.length){g.addClass("error");g.setAttribute("title",this.lang.invalidUrl);}}},_onDialogShow:function(){this.reset();this.videos.on("click",this._onSelectVideo,this);this.videos.on("scroll",this._onScrollResults,this);this.query.getInputElement().on("keydown",this._onKey,this,null,1);var i=this;if(c){this.url.getInputElement().on("input",this._onUrlChange,this,null,1);}else{var g;this._urlInterval=window.setInterval(function(){var m=i.url.getValue();if(m!==g){g=m;i._onUrlChange.call(i);}},400);}var j=this.dialog.videoNode;if(j){var l=f(j);if(l){var h=document.createElement("a");h.href=l;var k=h.pathname.split("/");if(k.length>2){this.editor.once("doksoftYoutubeSearchCompleted",function(){var p=a(j);if(p.width&&p.height&&this.getSelectedVideo()){var o=p.width+"x"+p.height,s=this.size.getInputElement(),m=s.getChildren(),q=m.count(),n,r;for(n=0;n<q;n++){r=m.getItem(n).getAttribute("value");if(r==o){s.setValue(o);return;}else{if(r=="custom"){s.setValue("custom");this.width.setValue(p.width);this.width.getElement().show();this.height.setValue(p.height);this.height.getElement().show();}}}}},this);this.search([k[2]]);}}}},_onDialogHide:function(){this.videos.removeListener("click",this._onSelectVideo);this.videos.removeListener("scroll",this._onScrollResults);this.query.getInputElement().removeListener("keydown",this._onKey);this.url.getInputElement().removeListener("input",this._onUrlChange);var g=this.url.getInputElement();g.removeAttribute("title");g.removeClass("error");window.clearInterval(this._urlInterval);window.clearTimeout(this._searchTimeout);this._searching=false;this.reset();},_init:function(){var h=this;var g=function(){jQuery.noConflict();if(!window.jQuery.fn.autocomplete){CKEDITOR.document.appendStyleSheet(h.path+"css/jquery-ui-1.10.4.autocomplete.min.css");CKEDITOR.document.appendStyleText(".ui-autocomplete { z-index: "+h.editor.config.baseFloatZIndex+100+" }");
CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(h.path+"js/jquery-ui-1.10.4.autocomplete.min.js"),function(i){if(i){h._initAutocomplete();}});}else{h._initAutocomplete();}};if(!window.jQuery){CKEDITOR.scriptLoader.load("//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js",function(i){if(!i){CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(h.path+"js/jquery-1.11.0.min.js"),function(j){if(j){g();}else{h.showMessage(h.lang.unableLoad);}});}else{g();}});}else{g();}},_initAutocomplete:function(){var h=this.query.getInputElement().$,g=this;jQuery(h).autocomplete({select:function(){g.searchButton.click();},source:function(m,j){var l="https://suggestqueries.google.com/complete/search",k={client:"youtube",ds:"yt",q:m.term,hl:"en"},i=this;jQuery.ajax({url:l,dataType:"jsonp",data:k,jsonp:"jsonp",success:function(o){var n=[];if(o&&o[1]&&CKEDITOR.tools.isArray(o[1])){jQuery.each(o[1],function(p,q){n.push({"value":q[0]});});}j(n);}});}});},search:function(j){if(!j||this._searching){return;}this.videosHint.hide();this.preloader.show();if(!window.jQuery){this._searchTimeout=CKEDITOR.tools.setTimeout(this.search,50,arguments);return;}var h=this;this._searching=true;var g=function(){h.preloader.hide();h._searching=false;var l=h.videosList.getFirst(),k=l&&l.getChildren().count();if(k){if(k==1){var m=h._getVideo(function(){return true;});m&&h.selectVideo(m);}h.videosList.show();}else{h.videosList.hide();h.videosHint.show();}};if(typeof j=="string"){var i={"part":"id","q":j,"maxResults":this.maxResults,"key":this.apiKey};if(this._nextPageToken){i.pageToken=this._nextPageToken;}this._lastQuery=j;jQuery.ajax({url:"https://www.googleapis.com/youtube/v3/search",dataType:"jsonp",data:i,success:function(m){if(!h._checkData(m)){g.call(h);return;}h._nextPageToken=m.nextPageToken;var l=[];for(var k=0;k<m.items.length;k++){l.push(m.items[k].id.videoId);}h._searching=false;h.search(l);},error:function(){h.showMessage(h.lang.searchFailed);g.call(h);}});}else{if(CKEDITOR.tools.isArray(j)){jQuery.ajax({url:"https://www.googleapis.com/youtube/v3/videos",dataType:"jsonp",data:{"part":"snippet,contentDetails","id":j.join(","),"key":this.apiKey},success:function(k){h._addData(k);},error:function(){h.showMessage(h.lang.searchFailed);},complete:function(){g.call(h);h.editor.fire("doksoftYoutubeSearchCompleted");}});}}},_checkData:function(g){if(!g){this.showMessage(this.lang.searchFailed);return false;}if(g.error){this.showMessage(this.lang.searchFailed+": "+(g.error.message||""));return false;}if(g.pageInfo&&g.pageInfo.totalResults===0){this.showMessage(this.lang.notFound);return false;}return true;},_addData:function(n){if(!this._checkData(n)){return;}var k=[],j;for(j=0;j<n.items.length;j++){var l=n.items[j],g=l.snippet.thumbnails["default"].url,h=l.contentDetails.definition;k.push('<li class="cke_doksoft_youtube_item" data-video-id="'+l.id+'" data-video-definition="'+h+'">');k.push('<div class="cke_doksoft_youtube_thumb"><img src="'+g+'" style="width:120px; height:90px;" alt=""></div>');k.push('<div class="cke_doksoft_youtube_info">');k.push('<div class="cke_doksoft_youtube_title">'+CKEDITOR.tools.htmlEncode(l.snippet.title)+"</div>");k.push('<div class="cke_doksoft_youtube_duration">'+durationToTime(l.contentDetails.duration)+"</div>");k.push("</div>");k.push("</li>");}if(k.length){var m=this.videosList.getFirst();if(!m){m=CKEDITOR.document.createElement("ul");this.videosList.append(m);}m.appendHtml(k.join(""));}},getSelectedVideo:function(){var g=this._getVideo(function(h){return h.hasClass("selected");});return g;},_getVideo:function(m){if(m&&typeof m=="function"){var l=this.videosList.getFirst();if(l&&l.is("ul")){var h=l.getChildren(),k=h.count(),g,j;for(g=0;g<k;g++){j=h.getItem(g);if(m.call(this,j)){return j;}}}}return null;},selectVideo:function(k){var g=this.getSelectedVideo();if(!k||(g&&g.equals(k))){return;}g&&g.removeClass("selected");k.addClass("selected");this.previewHint.hide();this.previewVideo.setHtml('<iframe src="//www.youtube.com/embed/'+k.data("video-id")+'?rel=0" frameborder="0"></iframe>');this.previewVideo.show();this.size.clear();var j=(k.data("video-definition")=="hd")?this.sizes.hd:this.sizes.sd;for(var h=0;h<j.length;h++){this.size.add(j[h],j[h]);}this.size.add(this.lang.custom,"custom");this.size.enable();this.showSuggested.enable();this.privacyMode.enable();this.useOldCode.enable();},reset:function(){this.size.clear().disable();this.width.getElement().hide();this.height.getElement().hide();this.showSuggested.disable();this.privacyMode.disable();this.useOldCode.disable();this.videosList.hide();this.videosList.setHtml("");this.preloader.hide();this.videosHint.show();this.previewVideo.hide();this.previewVideo.setHtml("");this.previewHint.show();this._nextPageToken=null;this._lastQuery=null;},showMessage:function(g){alert(g);}};function f(h){var g=d(h);return(g&&g.getAttribute("src"))||"";}function a(i){var h=d(i),g={};if(h){g.width=h.getAttribute("width");g.height=h.getAttribute("height");}return g;}function d(m){var l=null;
if(m&&m.is){if(m.is("iframe")){l=m;}else{if(m.is("cke:object")){var h=m.getChildren(),k=h.count(),g,j;for(g=0;g<k;g++){j=h.getItem(g);if(j.is("cke:embed")){l=j;break;}}}}}return l;}CKEDITOR.dialog.add("doksoft_youtube",function(h){var k=h.lang.doksoft_youtube,g=h.lang.common,i=CKEDITOR.plugins.get("doksoft_youtube").path,j=null;return{title:k.title,minWidth:650,minHeight:450,onLoad:function(){j=new b(h,this);},onShow:function(){this.fakeImage=this.videoNode=null;var l=this.getSelectedElement();if(l&&l.data("cke-real-element-type")&&l.data("cke-real-element-type")=="doksoft_youtube"){this.fakeImage=l;var m=h.restoreRealElement(l);this.videoNode=m;this.setupContent(m);}},onOk:function(){var o=j.getSelectedVideo();if(!o){return;}var t=this.getContentElement("info","useOldCode").getValue(),s=new CKEDITOR.dom.element(t?"cke:object":"iframe",h.document),m=this.getContentElement("info","showSuggested").getValue(),q=this.getContentElement("info","privacyMode").getValue(),n=o.data("video-id"),l="//www.youtube"+(q?"-nocookie":"")+".com/"+(t?"v":"embed")+"/"+n;if(t){l+="?hl=en_US&version=3";}if(!m){l+=(t?"&":"?")+"rel=0";}var r={},u={};if(!t){s.setAttribute("frameborder","0");s.setAttribute("allowfullscreen","allowfullscreen");s.setAttribute("src",l);}else{var p=new CKEDITOR.dom.element("cke:param",h.document);p.setAttribute("name","movie");p.setAttribute("value",l);s.append(p);p=new CKEDITOR.dom.element("cke:param",h.document);p.setAttribute("name","allowFullScreen");p.setAttribute("value","true");s.append(p);p=new CKEDITOR.dom.element("cke:param",h.document);p.setAttribute("name","allowscriptaccess");p.setAttribute("value","always");s.append(p);p=new CKEDITOR.dom.element("cke:embed",h.document);p.setAttribute("src",l);p.setAttribute("type","application/x-shockwave-flash");p.setAttribute("allowscriptaccess","always");p.setAttribute("allowfullscreen","true");s.append(p);}this.commitContent(s,r,u);var v=h.createFakeElement(s,"cke_doksoft_youtube","doksoft_youtube",s.is("iframe"));v.setAttributes(u);v.setStyles(r);if(this.fakeImage){v.replace(this.fakeImage);h.getSelection().selectElement(v);}else{h.insertElement(v);}},contents:[{id:"info",label:g.generalTab,padding:0,accessKey:"I",elements:[{type:"hbox",widths:["99%","1%"],children:[{id:"query",type:"text",inputStyle:"padding: 3px 6px;margin-bottom:12px",isChanged:false},{id:"btnSearch",type:"button",label:k.search,isChanged:false}]},{id:"url",type:"text",label:k.typeUrl,inputStyle:"padding: 3px 6px;margin-top:4px;margin-bottom:8px",isChanged:false},{type:"hbox",widths:["50%","50%"],style:"table-layout: fixed",children:[{id:"videos",type:"html",html:'<div class="cke_doksoft_youtube_videos" id="'+h.name+'_doksoft_youtube_videos">'+'<div class="cke_doksoft_youtube_videos__hint">'+k.catalogHint+"</div>"+'<div class="cke_doksoft_youtube_videos__list"></div>'+'<div class="cke_doksoft_youtube_videos__preloader"></div>'+"</div>"},{type:"vbox",children:[{id:"preview",type:"html",html:'<div class="cke_doksoft_youtube_preview" id="'+h.name+'_doksoft_youtube_preview">'+'<div class="cke_doksoft_youtube_preview__hint">'+k.previewHint+"</div>"+'<div class="cke_doksoft_youtube_preview__video"></div>'+"</div>"},{type:"vbox",className:h.name+"_doksoft_youtube_video_options",children:[{id:"size",type:"select","default":"",items:[],labelLayout:"horizontal",widths:["1%","99%"],inputStyle:"min-width: 100px;",labelStyle:"margin-right: 5px;",label:k.size,isChanged:false,commit:function(q,s,p){var r=this.getValue(),m=[],n,l;if(r=="custom"){m=[this.getDialog().getContentElement("info","width").getValue(),this.getDialog().getContentElement("info","height").getValue()];if(!m[0]||!m[1]){m=this.getInputElement().getFirst().getAttribute("value").split("x");}}else{m=this.getValue().split("x");}if(m.length==2){n=m[0];l=m[1];s.width=n+"px";s.height=l+"px";var o=d(q);if(o){o.setAttribute("width",n);o.setAttribute("height",l);}}},onChange:function(){var n=this.getDialog().getContentElement("info","width"),l=this.getDialog().getContentElement("info","height"),m=this.getValue()=="custom";n.setValue("");l.setValue("");n.getElement()[m?"show":"hide"]();l.getElement()[m?"show":"hide"]();m&&n.focus();}},{type:"hbox",widths:["50%","50%"],children:[{id:"width",type:"text",label:k.width,labelLayout:"horizontal",labelStyle:"margin-right: 5px;",widths:["1%","99%"],hidden:true,isChanged:false,onKeyup:function(){var m=this.getValue(),n=this.getDialog().getContentElement("info","size").getInputElement().getFirst().getAttribute("value").split("x"),l=n[1]/n[0];this.getDialog().getContentElement("info","height").setValue(Math.round(m*l));}},{id:"height",type:"text",label:k.height,labelLayout:"horizontal",labelStyle:"margin-right: 5px;",widths:["1%","99%"],hidden:true,isChanged:false,onKeyup:function(){var l=this.getValue(),n=this.getDialog().getContentElement("info","size").getInputElement().getFirst().getAttribute("value").split("x"),m=n[0]/n[1];this.getDialog().getContentElement("info","width").setValue(Math.round(l*m));
}}]},{id:"showSuggested",type:"checkbox","default":h.config.doksoft_youtube_showSuggested,labelLayout:"horizontal",label:k.showSuggested,labelStyle:"vertical-align: bottom;",inputStyle:"vertical-align: bottom;",isChanged:false,setup:function(m,l){var n=f(m);if(n.indexOf("rel=0")>0){this.setValue(false);}}},{id:"privacyMode",type:"checkbox","default":h.config.doksoft_youtube_enablePrivacyMode,labelLayout:"horizontal",label:k.privacyMode,labelStyle:"vertical-align: bottom;",inputStyle:"vertical-align: bottom;",isChanged:false,setup:function(m,l){var n=f(m);if(n.indexOf("-nocookie")>0){this.setValue(true);}}},{id:"useOldCode",type:"checkbox","default":h.config.doksoft_youtube_useOldCode,labelLayout:"horizontal",label:k.oldEmbedCode,labelStyle:"vertical-align: bottom;",inputStyle:"vertical-align: bottom;",isChanged:false,setup:function(m,l){if(m.is("cke:object")){this.setValue(true);}}}]}]}]},{type:"html",html:'<style type="text/css">'+".cke_doksoft_youtube_video_options td {"+"	vertical-align: middle;"+"}"+".cke_doksoft_youtube_videos {"+"	width: 100%;"+"	height: 350px;"+"	margin-top: 10px;"+"	border: 1px solid #aeb3b9;"+"	overflow-x: hidden;"+"	overflow-y: auto;"+"}"+".cke_doksoft_youtube_videos__hint {"+"	line-height: 350px;"+"}"+".cke_doksoft_youtube_videos__list ul {"+"	margin: 0;"+"	padding: 0;"+"	list-style: none;"+"}"+".cke_doksoft_youtube_preview {"+"	width: 100%;"+"	height: 200px;"+"	margin-top: 5px;"+"	border: 1px solid #aeb3b9;"+"}"+".cke_doksoft_youtube_preview__video,"+".cke_doksoft_youtube_preview__video iframe {"+"	width: 100%;"+"	height: 100%;"+"}"+".cke_doksoft_youtube_preview__hint {"+"	line-height: 200px;"+"}"+".cke_doksoft_youtube_videos__hint,"+".cke_doksoft_youtube_preview__hint {"+"	text-align: center;"+"	cursor: default;"+"}"+".cke_doksoft_youtube_videos__preloader {"+"	width: 100%;"+"	height: 32px;"+"	margin: 10px 0;"+"	background: transparent url("+i+"images/preloader.gif) scroll no-repeat center 0;"+"}"+".cke_doksoft_youtube_item {"+"	margin: 2px;"+"	padding: 2px;"+"	height: 90px;"+"	clear: both;"+"	overflow: hidden;"+"	border: 1px solid #c9cccf;"+"}"+".cke_doksoft_youtube_item.selected,"+".cke_doksoft_youtube_item:hover {"+"	border: 1px solid #139ff7;"+"	background-color: #cce7f3;"+"}"+".cke_doksoft_youtube_item, .cke_doksoft_youtube_item * {"+"	cursor: pointer;"+"}"+".cke_doksoft_youtube_thumb {"+"	float: left;"+"	margin-right: 2px;"+"	width: 120px;"+"	height: 90px;"+"}"+".cke_doksoft_youtube_info {"+"}"+".cke_doksoft_youtube_title {"+"	font-size: 120%;"+"	font-weight: bold;"+"	white-space: normal;"+"}"+".cke_dialog_ui_input_text.error,"+".cke_dialog_ui_input_text.error:focus,"+".cke_dialog_ui_input_text.error:hover {"+"	border: 1px solid #f00;"+"}"+"</style>"}]}]};});})();CKEDITOR.config.doksoft_youtube_maxResults=25;CKEDITOR.config.doksoft_youtube_showSuggested=true;CKEDITOR.config.doksoft_youtube_enablePrivacyMode=false;CKEDITOR.config.doksoft_youtube_useOldCode=false;